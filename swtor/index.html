<!DOCTYPE html>
<html>
	<head>
		<style>
			h1 {
				margin: 0px;
			}
			
			h2 {
				font-size: 0.7em;
				font-style: italic;
			}
			
			* {
				font-family: sans-serif;
			}
			
			td, th {
				border: solid 0.1em black;
				border-radius: 0.3em;
				padding: 0.7em;
				text-align: center;
			}
			
			th {
				font-weight: bold;
				background-color: #DDDDDD;
			}
			
			select, input {
				margin: 0.5em;
				padding: 0.3em;
			}

			input {
				font-weight: bold;
			}
			
			tr:hover > td {
				background-color: black;
				color: white;
			}
			
			.footnote {
				font-weight: normal;
				font-size: 0.8em;
			}
			
			.btnSubmit {
				font-size: 1.5em;
			}
			
			.tooltipLink {
				display: inline-block;
				border-bottom: dotted 1px black;
			}
			
			.tooltipLink:hover .tooltip{
				visibility: visible;
			}
			
			.tooltip {
				visibility: hidden;
				width: 15em;
				padding: 0.75em;
				margin: 0em;
				font-weight: bold;
				text-align: center;
				border-radius: 0.25em;
				position: absolute;
				z-index: 1;
				background-color: black;
				color: white;
			}
		</style>
		<script>
			function listVariations() {
				const theAccuracy = parseInt(document.getElementById("accuracy").value);
				const theAlacrity = parseInt(document.getElementById("alacrity").value);
				const theIRating = parseInt(document.getElementById("iRating").value);
				const theAugment = parseInt(document.getElementById("augment").value);
				const theStim = document.getElementById("stim").value;
				const implantRating = parseInt(document.getElementById("implantRating").value);
				// Implant Stats
				let baseAccuracy = 0;
				let baseAlacrity = 0;
				let baseCrit = 0;
				
				let iNo = 1;
				while (iNo < 3){
					switch (document.getElementById("implant" + iNo + "Stat").value) {
						case "accuracy":
							baseAccuracy += implantRating;
							break;
						case "alacrity":
							baseAlacrity += implantRating;
							break;
						case "critical":
							baseCrit += implantRating;
							break;
					}
					iNo++;
				}
				
				let gearCount = 0;
				let augmentCount = null;
				let statTotal = 0;
				
				let alacrityArray = [];
				let accuracyArray = [];
				
				function getCount(stat, baseStat, useStim = 0) {
					augmentCount = 0;
					statTotal = baseStat + (gearCount * theIRating) + (useStim * 264);
					while (statTotal < stat) {
						if (augmentCount > 13) {
							gearCount++;
							augmentCount = 0;
						} else {
							augmentCount++;
						}
						statTotal = baseStat + (gearCount * theIRating) + (augmentCount * theAugment) + (useStim * 264);
					}
					if (stat == theAccuracy) {
						needStim = "No";
						if (useStim) {
							needStim = "Yes";
						}
						return {gearC: gearCount, augmentC: augmentCount, overflow: statTotal - stat, stim: needStim};
					} else {
						return {gearC: gearCount, augmentC: augmentCount, overflow: statTotal - stat};
					}
				}
				
				if (theAlacrity > 0){
					while (augmentCount != 0) {
						alacrityArray.push(getCount(theAlacrity, baseAlacrity));
						gearCount++;
					}
					alacrityArray.sort(function (a, b) {
						return a.overflow - b.overflow;
					});
				}
				
				if (theAccuracy > 0){
					if (theStim != ("versatile")) {
						augmentCount = null;
						gearCount = 0;
						while (augmentCount != 0) {
							accuracyArray.push(getCount(theAccuracy, baseAccuracy, 1));
							gearCount++;
						}
					}
					if (theStim != ("proficient")) {
						augmentCount = 15;
						gearCount = 0;
						while (augmentCount != 0) {
							accuracyArray.push(getCount(theAccuracy, baseAccuracy));
							gearCount++;
						}
					}
					accuracyArray.sort(function (a, b) {
						return a.overflow - b.overflow;
					});
				}
				drawResults(alacrityArray, accuracyArray, baseCrit);
			}
			
			function drawResults(alacrityList, accuracyList, baseCrit) {
				let output = null;
				if (accuracyList.length == 0 && alacrityList.length > 0) {//alacrity only
					output = "<tr><th>Alacrity Gear Count <span class='footnote'><br>[excluding implants]</span></th><th>Alacrity Augment Count</th><th>Overcapped Amount</th><th>Available Critical Rating <span class='footnote'><br>[excluding stim/crystal etc.]</span></th></tr>";
					for (let i = 0; i < alacrityList.length; i++) {
						let maxCrit = baseCrit + ((8 - alacrityList[i].gearC) * document.getElementById("iRating").value) + ((14 - alacrityList[i].augmentC) * document.getElementById("augment").value);
						output += "<tr><td>" + alacrityList[i].gearC + "</td><td>" + alacrityList[i].augmentC + "</td><td>" + alacrityList[i].overflow + "</td><td>" + maxCrit + "</td></tr>";
					}
				} else if (alacrityList.length == 0 && accuracyList.length > 0) {//accuracy only
					output = "<tr><th>Accuracy Gear Count <span class='footnote'><br>[excluding implants]</span></th><th>Accuracy Augment Count</th><th>Proficient Stim Required</th><th>Overcapped Amount</th><th>Available Critical Rating <span class='footnote'><br>[excluding stim/crystal etc.]</span></th></tr>";
					for (let i = 0; i < accuracyList.length; i++) {
						let maxCrit = baseCrit + ((8 - accuracyList[i].gearC) * document.getElementById("iRating").value) + ((14 - accuracyList[i].augmentC) * document.getElementById("augment").value);
						output += "<tr><td>" + accuracyList[i].gearC + "</td><td>" + accuracyList[i].augmentC + "</td><td>" + accuracyList[i].stim + "</td><td>" + accuracyList[i].overflow + "</td><td>" + maxCrit + "</td></tr>";
					}
				} else if (alacrityList.length > 0 && accuracyList.length > 0) {
					let alcAccList = [];
					for (let i = 0; i < accuracyList.length; i++) {
						let alcClass = null;
						for (let j = 0; j < alacrityList.length; j++) {
							if ((accuracyList[i].augmentC + alacrityList[j].augmentC) < 15){
								alcClass = alacrityList[j];
								j = alacrityList.length;
							}
						}
						if ((accuracyList[i].gearC + alcClass.gearC) < 9) {
							alcAccList.push({
								accGear: accuracyList[i].gearC,
								accAug: accuracyList[i].augmentC,
								accStim: accuracyList[i].stim,
								alcGear: alcClass.gearC,
								alcAug: alcClass.augmentC,
								totalOverflow: accuracyList[i].overflow + alcClass.overflow
							});
						}
					}
					alcAccList.sort(function (a, b) {
						return a.totalOverflow - b.totalOverflow;
					});
					if (alcAccList.length > 0) {
						output = "<tr><th>Alacrity Gear Count <span class='footnote'><br>[excluding implants]</span></th><th>Alacrity Augment Count</th><th>Accuracy Gear Count <span class='footnote'><br>[excluding implants]</span></th><th>Accuracy Augment Count</th><th>Proficient Stim Required</th><th>Overcapped Amount</th><th>Available Critical Rating <span class='footnote'><br>[excluding stim/crystal etc.]</span></th></tr>";
						for (let i = 0; i < alcAccList.length; i++) {
							let maxCrit = baseCrit + ((8 - alcAccList[i].alcGear - alcAccList[i].accGear) * document.getElementById("iRating").value) + ((14 - alcAccList[i].alcAug - alcAccList[i].accAug) * document.getElementById("augment").value);
							output += "<tr><td>" + alcAccList[i].alcGear + "</td><td>" + alcAccList[i].alcAug + "</td><td>" + alcAccList[i].accGear + "</td><td>" + alcAccList[i].accAug + "</td><td>" + alcAccList[i].accStim + "</td><td>" + alcAccList[i].totalOverflow + "</td><td>" + maxCrit + "</td></tr>";
						}
					} else {
						output = "No combinations available";
					}
				}
				
				document.getElementById("result").innerHTML = output;
			}
		</script>
		<title>
			SWTOR Alacrity and Accuracy Calculator
		</title>
	</head>
	<body>
		<h1>
			SWTOR Level 80 Augment and Gear Combination Calculator [7.1]
		</h1>
		<h2>
			Made By CarpalTunneler - Galaxy Knights [Satele Shan]
		</h2>
		Accuracy % Required:
		<select id="accuracy">
			<option value=0>None - [Healer]</option>
			<option value=2694>10% - [DPS PVE]</option>
			<option value=1081>5% - [DPS PVP]</option>
		</select>
		<br>
		Alacrity GCD Required:
		<select id="alacrity">
			<option value=2051>1.4 second GCD</option>
			<option value=5426>1.3 second GCD</option>
			<option value=1120>1.4 second GCD [Arsenal/Gunnery or Carnage/Combat]</option>
			<option value=4017>1.3 second GCD [Arsenal/Gunnery or Carnage/Combat]</option>
			<option value=1808>1.3 second GCD [Arsenal/Gunnery with 6 Supercharged Velocity]</option>
			<option value=558>1.4 second GCD [Lightning/Telekinetics]</option>
			<option value=3205>1.3 second GCD [Lightning/Telekinetics]</option>
			<option value=0>1.5 second GCD [Default]</option>
		</select>
		<br>
		<!--
		Alacrity Relic Used and Active?
		<input type="checkbox" id="relic">
		<br>
		-->
		<div class="tooltipLink">Item Rating:
			<span class="tooltip">This includes Main Hand, Off Hand, Helmet, Body Armour, Gloves, Boots, & Ear Piece</span>
		</div>
		<select id="iRating">
			<option value=543>328</option>
			<option value=554>330</option>
			<option value=566>332 [PVP Cap]</option>
			<option value=577>334</option>
			<option value=589>336</option>
			<option value=602>338</option>
			<option value=614>340</option>
			<option value=627>342 - PTS</option>
			<option value=640>344 - PTS</option>
		</select>
		<br>
		Augment Rating:
		<select id="augment">
			<option value=95>276 [Prototype]</option>
			<option value=108 selected>286 [Artifact]</option>
			<option value=130>300 [Legendary]</option>
		</select>
		<br>
		Stimulant Used:
		<select id="stim">
			<option value="both">Show All</option>
			<option value="proficient">Proficient [264 Accuracy / 109 Critical]</option>
			<option value="versatile">Versatile/Other/None</option>
		</select>
		<br>
		Implant Rating: 
		<select id="implantRating">
			<option value=543>328</option>
			<option value=554>330</option>
			<option value=566>332 [PVP Cap]</option>
			<option value=577 selected>334</option>
			<option value=589>336 - PTS</option>
			<option value=602>338 - PTS</option>
			<option value=614>340 - PTS</option>
		</select>
		<br>
		Implant 1 Stat:
		<select id="implant1Stat">
			<option value="accuracy">Accuracy</option>
			<option value="alacrity">Alacrity</option>
			<option value="critical" selected>Critical</option>
		</select>
		<br>
		Implant 2 Stat:
		<select id="implant2Stat">
			<option value="accuracy">Accuracy</option>
			<option value="alacrity">Alacrity</option>
			<option value="critical" selected>Critical</option>
		</select>
		<br>
		<input type="button" value="List Combinations" class="btnSubmit" onclick="listVariations()">
		<br>
		<table id="result"></table>
	</body>
</html> 